---
title: 统计代码放在哪？
layout: post
toc: false
comments: true
date: 2017-02-27 16:50:05
tags:
---

在游戏开发中，都会对游戏内特定事件打点标记，通过数据统计来了解玩家的行为和各功能活动的效果。

这个在业务代码中插入统计语句的行为，有很多种做法。

1. 把所有需要统计的事件放在一个地方，记在一个表里，业务代码中通过索引来取得事件的名称等信息，进行上报。
    例如： Events.lua 中记录所有的事件，Events = {[1] = "微信登录成功", [2] = "支付宝支付成功"...}
    登录时上报 report(Events[1]), 支付时上报 report(Events[2])。

2. 在业务代码中，直接写上内容。登录时上报 report("微信登录成功")，支付时上报 report("支付宝支付成功")。

这里的2种处理方式，很多时候都会碰到，例如服务器下行消息的错误码，可以集中在一个表里，也可以在每条消息处理时自己判断。

这些处理方式的好坏，我有2点考虑。

1. 这些插入的代码的生命期。消息改了，错误码跟着改，支付方式改了，打点的地方也要跟着改。
2. 是否直观，所见即所得。看到 report(Events[1]) 能否知道是什么，看到 ErrorCode[1] 能否知道是什么。

所以我比较支持在业务代码中直接写上内容。随着代码优化、重构，这些打点的内容能让后来者一眼看明白，并把它放到正确的地方。